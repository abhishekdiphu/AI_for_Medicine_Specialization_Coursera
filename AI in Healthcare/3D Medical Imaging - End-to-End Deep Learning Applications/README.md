
## Introduction :

Sementic segmentation of Spleen dataset. We have used only single volume of spleen MRI scan.A 2d unet is being used . So data volume has been sliced , to shape of single channel along a choosen axis preferable across coronal axis. 

## Model Network :
- UNet
- its a encoder-decoder network
- input shape of 512 x 512.
- output shape is 512 x 512
- skip connection between encoder and decoder network.


## Dataset:
### Spleen 

- bits per pixel: 32
- Spatial unit: mm, Temporal unit: sec
- Grid is regular with grid spacings: [1.       0.794922 0.794922 5.       0.       0.       0.       0.      ]
- Sagittal: 0, Axial: 1, Coronal: 2
- the volume (in mm³) of a spleen: 96672
- one outlier above 500000
- image_data.shape: (512, 512, 90), label_data.shape: (512, 512, 90) 
- histogram of voxels in the images .




### model is stored in :
- model.py (its a 2d unet model)

### to train:
- python training.py

### to do inference :
- python infernece.py
- models are stored in models folders
- data is put in data folders.
- output volume from the prediction is stored in data folder as out.nii.gz format

### to evaluate the performace :
- python evaluation.py

# 3D MEDICAL IMAGING :

## Modelities in 3D imaging :
- CT 
- MRI
- SPECT
- ULTRASOUND
### vocab
- 1. Imaging modality: a device used to acquire a medical image
- 2. MRI scanner: Magnetic Resonance Imaging scanner
- 3. Contrast resolution: the ability of an imaging modality to distinguish between differences in image intensity
- 4. Spatial resolution: the ability of an imaging modality to differentiate between smaller objects

## People (end users) using 3d imaging :
- 1. Primary users : 
- 2. Secialist :
- 3. Surgeons
- 4. Radiologist : they are the imaging specialist

## Some usecases of 3d medical imageing 
- 1. Diagonisis
- 2. Prognosis
- 3. Procedural process such as surgery.
-
## NIFTI :

Like DICOM, NIFTI, which stands for Neuroimaging Informatics Technology Initiative, is an open standard that is available at https://nifti.nimh.nih.gov/nifti-2. The standard has started out as a format to store neurological imaging data and has slowly seen a larger adoption across other types of biomedical imaging fields.

Some things that distinguish NIFTI from DICOM, though are:

NIFTI is optimized to store serial data and thus can store entire image series (and even study) in a single file.
NIFTI is not generated by scanners; therefore, it does not define nearly as many data elements as DICOM does. Compared to DICOM, there are barely any, and mostly they have to do with geometric aspects of the image. Therefore, NIFTI files by themselves can not constitute a valid patient record but could be used to optimize storage, alongside some sort of patient info database.
NIFTI files have fields that define units of measurements and while DICOM files store all dimensions in mm, it’s always a good idea to check what units of measurement are used by NIFTI.
When addressing voxels, DICOM uses a right-handed coordinate system for X, Y and Z axes, while NIFTI uses a left-handed coordinate system. Something to keep in mind, especially when mixing NIFTI and DICOM data.
Further Resources
Background and history of the NIFTI: https://nifti.nimh.nih.gov/background/
The most “official” reference of NIFTI data fields could be found in this C header file, published on the standard page: https://nifti.nimh.nih.gov/pub/dist/src/niftilib/nifti1.h or on this, slightly better-organized page: https://nifti.nimh.nih.gov/nifti-1/documentation/nifti1fields
A great blog post on NIFTI file format: https://brainder.org/2012/09/23/the-nifti-file-format/
New Vocabulary
NIFTI - Neuroimaging Informatics Technology Initiative, is an open standard that is used to store various biomedical data, including 3D images.

## Important Parameters of Medical Images:

##### Orientation parameters
For DICOM two parameters that define the relative position of a 2D in the 3D space would be:

- (0020,0037) Image Orientation Patient - a parameter that stores two vectors (directional cosines to be precise) that define the orientation of the first row and first column of the image.

- (0020,0032) Image Position Patient - a parameter that stores x, y, and z coordinates of the upper left-hand corner of the image.

Both of these are Type 1 (mandatory) parameters for MR and CT IODs, so it is generally safe to rely on them.

For NIFTI, the same purpose is served by srow_*, qoffset_* vectors.

##### Physical spacing parameters
(0028,0030) Pixel Spacing - two values that store the physical distance between centers of pixels across x and y axes.

(0018,0050) Slice Thickness - thickness of a single slice. Note that this one is a Type 2 (required, but can be zero) parameter for CT and MR data. If you find those unavailable, you can deduce slice thickness from IPP parameters. This can happen if your volume has non-uniform slice thickness.

##### Photometric parameters
There are quite a few of those, as DICOM can store both grayscale and color data, so lots of parameters deal with color palettes. CT and MR images usually have monochrome pixel representation (defined by tag (0028,0004) Photometric Interpretation).

##### Most notable ones of this group are:

(0028,0100) Bits Allocated - parameter that defines the number of bits allocated per pixel (since we have CPUs that operate in bytes, this parameter is always a multiple of 8).

(0028,0101) Bits Stored - parameter that defines the number of bits that are actually used - quite often, you could see Bits Allocated set to 16, but Bits Stored set to 12.

##### Image size parameters
Of worthy mention are parameters that define the size of the 3D volume. There are Type 1 parameters that define the width and height of each 2D slice:

(0020,0010) Rows - this is the height of the slice, in voxels

(0020,0011) Columns - width of the slice, in voxels

##### Both of these need to be consistent across all DICOM files that comprise a series.

Note that there isn’t really anything in DICOM metadata that has to tell you how many slices you have in the series. There are tags that can hint at this (like (0054,0081) Number of Slices, or (0020,0013) Instance Number), but none of them are mandatory, Type 1 tags for CT or MR data. The most reliable way to determine the number of slices in the DICOM series is to look at the number of files that you have, and ideally validate that they make up a correct volume by checking for the consistency of IPP values.

## Basic DICOM Volume EDA:

##### Voxel spacing
DICOM voxels do not have to be perfect cubes (as they are in many computer vision problems). There are DICOM Data Elements that will tell you what exactly are the dimensions of voxels. The most important ones are Pixel Spacing and Slice Thickness. However, there are others, and if your project involves measuring things, make sure you get the transformation right by closely inspecting the tags in your dataset and comparing them with the list of elements in the IOD table for the respective modality.

##### Data ranges
We have seen how with CT, you may have data in your dataset that will represent synthetic material or items artificially added by scanners. It is always a good idea to see if there is something outstanding in the image you are dealing with and if it represents something that you need to think about in your downstream processing.

Conversions between DICOM values and screen space are particularly important if you are planning to visualize slices for any kind of diagnostic use or overlay them on top of diagnostic information. We have not really touched the aspects of visualization other than being mindful of bit depth and doing our own windowing, but DICOM images contain quite a lot of information that defines how exactly you are expected to map the data to the screen colorspace. If you are interested in exploring this further or need to accurately represent the data, take a closer look at elements in DICOM’s ImagePixel module. Things like Pixel Representation, Photometric Interpretation, Rescale Slope, Rescale Intercept and many others define how values should be transformed for accurate representation.


# 3D imaging EDA summary :

## Vocabulary
- DICOM - Digital Imaging and Communication in Medicine. The standard defining the storage and communication of medical images.
- DICOM Information Object - representation of a real-world object (such as an MRI scan) per DICOM standard.
- IOD - Information Object Definition. Definition of an information object. Information Object Definition specifies what metadata fields have to be in place for a DICOM Information Object to be valid. IODs are published in the DICOM standard.
- Patient - a subject undergoing the imaging study.
- Study - a representation of a “medical study” performed on a patient. You can think of a study as a single visit to a hospital for the purpose of taking one or more images, usually within. A - Study contains one or more series.
- Series - a representation of a single “acquisition sweep”. I.e., a CT scanner took multiple slices to compose a 3D image would be one image series. A set of MRI T1 images at different axial levels would also be called one image series. Series, among other things, consists of one or more instances.
- Instance - (or Image Information Entity instance) is an entity that represents a single scan, like a 2D image that is a result of filtered backprojection from CT or reconstruction at a given level for MR. Instances contain pixel data and metadata (Data Elements in DICOM lingo).
- SOP - Service-Object Pair. DICOM standard defines the concept of an Information Object, which is the representation of a real-world persistent object, such as an MRI image (DICOM Information Objects consist of Information Entities).
- Data Element - a DICOM metadata “field”, which is uniquely identified by a tuple of integer numbers called group id and element id.
- VR - Value Representation. This is the data type of a DICOM data element.
- Data Element Type - identifiers that are used by Information Object Definitions to specify if Data Elements are mandatory, conditional or optional.
- NIFTI - Neuroimaging Informatics Technology Initiative, is an open standard that is used to store various biomedical data, including 3D images.
